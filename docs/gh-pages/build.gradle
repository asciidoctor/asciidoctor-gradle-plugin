plugins {
    id 'org.ajoberstar.git-publish'
    id 'org.ajoberstar.grgit'
}

ext {
    currentBranch = grgit.branch.current().name

    pushDocs = currentBranch.matches(~/^master|development-.+|maintenance-.+$/)
}

gitPublish {
    repoUri = gitHubRepoUri
    branch = pagesBranch

    contents {
        into currentBranch
        from rootProject.tasks.combineDocs
    }

    preserve {
        include '**'
        exclude "${currentBranch}/**"
    }

    commitMessage = "Updating SNAPSHOT documentation for ${currentBranch} at ${version}"
}

task publishDocs {
    if(pushDocs) {
        dependsOn gitPublishPush
    }
}
