import org.apache.tools.ant.filters.ReplaceTokens

task asciidoctorEditorConfig(type: Copy) {

    ext {
        pluginTokens = docProjects.collectEntries { proj ->
            ["plugin-${proj}".toString(), file("${pluginProjectDir(proj)}/src").absolutePath]
        } + [
            revnumber: version
        ]
        additionalAttributes = file('src/docs/asciidoc/attributes.adoc')
    }

    group 'IDE tasks'
    description 'Renders IDE config for Asciidoctor'
    inputs.file additionalAttributes

    from 'gradle/asciidoctorconfig-template.txt'
    into rootProject.projectDir
    rename 'asciidoctorconfig-template.txt', '.asciidoctorconfig'

    // try to keep the token list alphabetical.
    filter ReplaceTokens, beginToken: '@@', endToken: '@@', tokens: pluginTokens

    doLast {
        new File(rootProject.projectDir, '.asciidoctorconfig').withWriterAppend { w ->
            w << additionalAttributes.text

        }
    }
}

tasks.idea.dependsOn asciidoctorEditorConfig
